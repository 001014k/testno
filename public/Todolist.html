<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todolist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        html, body {
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
            height: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>

<body class="bg-[#080808] text-white flex items-center justify-center">
    <div class="fixed top-0 left-0 right-0 flex justify-between items-start w-full bg-[#080808] py-4 px-6">
        <a href="index.html" class="text-sm px-2">Home</a>
        <a href="Profile.html" class="text-sm px-2">Profile</a>
        <a href="Gallery.html" class="text-sm px-2">Gallery</a>
        <a href="Study.html" class="text-sm px-2">Study</a>
        <a href="Todolist.html" class="text-sm px-2">Todolist</a>
        <a href="usermanage.html" class="text-sm px-2">Usermanage</a>
        <a href="market.html" class="text-sm px-2">Market</a>
        <a href="cart.html" class="text-sm px-2">Pay</a>
    </div>

    <div class="w-full h-full flex flex-col items-center justify-start mt-20">
        <h1 class="text-[34px] font-bold mb-6">ToDoList</h1>
        <div class="mb-4">
            <p class="flex flex-wrap items-center gap-2">
                <span>일정 추가: </span>
                <input type="text" class="title bg-gray-800 text-white p-2 rounded">
                <label><input type="checkbox" class="daySelect" value="monday"> 월</label>
                <label><input type="checkbox" class="daySelect" value="tuesday"> 화</label>
                <label><input type="checkbox" class="daySelect" value="wednesday"> 수</label>
                <label><input type="checkbox" class="daySelect" value="thursday"> 목</label>
                <label><input type="checkbox" class="daySelect" value="friday"> 금</label>
                <label><input type="checkbox" class="daySelect" value="saturday"> 토</label>
                <label><input type="checkbox" class="daySelect" value="sunday"> 일</label>
                <button id="saveBtn" class="bg-white hover:bg-white text-black py-2 px-4 rounded">저장</button>
            </p>
        </div>

        <div class="days w-full px-6 flex justify-between gap-4">
            <div id="monday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded" >
                <h2 class="text-2xl">월</h2>
                <ul class="resultArea list-none pl-0"></ul>
            </div>
            <div id="tuesday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded">
                <h2 class="text-2xl">화</h2>
                <ul class="resultArea list-none pl-0"></ul>
            </div>
            <div id="wednesday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded">
                <h2 class="text-2xl">수</h2>
                <ul class="resultArea list-none pl-0 "></ul>
            </div>
            <div id="thursday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded">
                <h2 class="text-2xl">목</h2>
                <ul class="resultArea list-none pl-0"></ul>
            </div>
            <div id="friday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded">
                <h2 class="text-2xl">금</h2>
                <ul class="resultArea list-none pl-0"></ul>
            </div>
            <div id="saturday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded">
                <h2 class="text-2xl">토</h2>
                <ul class="resultArea list-none pl-0"></ul>
            </div>
            <div id="sunday" class="day mb-4 w-1/7 border border-gray-700 p-2 rounded">
                <h2 class="text-2xl">일</h2>
                <ul class="resultArea list-none pl-0"></ul>
            </div>
        </div>
    </div>

    <script>
        var saveBtn = document.querySelector("#saveBtn");
        var title = document.querySelector(".title");
        var daySelects = document.querySelectorAll(".daySelect");
        var todoList = {
            monday: [],
            tuesday: [],
            wednesday: [],
            thursday: [],
            friday: [],
            saturday: [],
            sunday: []
        };
        var todoSeq = 105;

        function myFindIdx(todoList, todo) {
            var idx = todoList.findIndex(function (t) {
                return t.no === todo.no;
            });
            return idx;
        }

        function drawList(day) {
            var listArea = document.querySelector("#" + day + " .resultArea");
            listArea.innerHTML = "";
            todoList[day].forEach(function (todo) {
                var liTag = document.createElement("li");
                var checkBox = document.createElement("input");
                var delBtn = document.createElement("button");
                var spanTag = document.createElement("span");

                liTag.style.listStyle = "none";
                checkBox.setAttribute("type", "checkbox");
                spanTag.setAttribute("class", "");
                checkBox.removeAttribute("checked");
                if (todo.done) {
                    checkBox.setAttribute("checked", "checked");
                    spanTag.setAttribute("class", "okTitle");
                }
                spanTag.innerHTML = todo.title + " ";
                delBtn.innerText = "삭제";
                delBtn.classList.add("ml-2", "bg-white", "hover:bg-white", "text-black", "py-1", "px-2", "rounded");

                delBtn.addEventListener('click', function (event) {
                    var idx = myFindIdx(todoList[day], todo);
                    if (idx != -1) {
                        todoList[day].splice(idx, 1);
                        drawList(day);
                    }
                });

                checkBox.addEventListener('change', function (event) {
                    var idx = myFindIdx(todoList[day], todo);
                    if (idx != -1) {
                        todoList[day][idx].done = !todoList[day][idx].done;
                        drawList(day);
                    }
                });

                liTag.appendChild(checkBox);
                liTag.appendChild(spanTag);
                liTag.appendChild(delBtn);
                listArea.appendChild(liTag);
            });
        }

        function append() {
            var selectedDays = Array.from(daySelects).filter(input => input.checked).map(input => input.value);
            selectedDays.forEach(function (day) {
                todoList[day].push({
                    no: todoSeq++,
                    title: title.value,
                    done: false
                });
                drawList(day);
            });
            title.value = "";
            title.focus();
        }

        saveBtn.onclick = function () {
            append();
        }

        title.onkeydown = function (e) {
            if (e.keyCode === 13) {
                append();
            }
        }
    </script>

<div>
    <button id="authorize_button" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded mb-4">Authorize Google Calendar</button>
    <button id="signout_button" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded mb-4" style="display:none">Sign Out</button>
</div>

<script>
    var CLIENT_ID = '234632397827-6drfa5tsleandgrlq02i508dhf5un03o.apps.googleusercontent.com';
    var API_KEY = 'AIzaSyAv97SOjIkLEbwgN_kQ5c6nveF8UgkC2Ho';
    var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
    var SCOPES = "https://www.googleapis.com/auth/calendar.events";

    var authorizeButton = document.getElementById('authorize_button');
    var signoutButton = document.getElementById('signout_button');

    function handleClientLoad() {
        gapi.load('client:auth2', initClient);
    }

    function initClient() {
        gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            discoveryDocs: DISCOVERY_DOCS,
            scope: SCOPES
        }).then(function () {
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
            updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            authorizeButton.onclick = handleAuthClick;
            signoutButton.onclick = handleSignoutClick;
        }, function (error) {
            console.error(JSON.stringify(error, null, 2));
        });
    }

    function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
            authorizeButton.style.display = 'none';
            signoutButton.style.display = 'block';
            listUpcomingEvents();
        } else {
            authorizeButton.style.display = 'block';
            signoutButton.style.display = 'none';
        }
    }

    function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
    }

    function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
    }

    function listUpcomingEvents() {
        gapi.client.calendar.events.list({
            'calendarId': 'primary',
            'timeMin': (new Date()).toISOString(),
            'showDeleted': false,
            'singleEvents': true,
            'maxResults': 10,
            'orderBy': 'startTime'
        }).then(function(response) {
            var events = response.result.items;
            if (events.length > 0) {
                appendPre('Upcoming events:');
                for (var i = 0; i < events.length; i++) {
                    var event = events[i];
                    var when = event.start.dateTime;
                    if (!when) {
                        when = event.start.date;
                    }
                    appendPre(event.summary + ' (' + when + ')')
                }
            } else {
                appendPre('No upcoming events found.');
            }
        });
    }

    function appendPre(message) {
        var pre = document.getElementById('content');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
    }

    handleClientLoad();
</script>
</body>

</html>
